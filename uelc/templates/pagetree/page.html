{% extends 'pagetree/base_pagetree.html' %}
{% load render %}
{% load accessible %}

{% block js %}
{% for block in section.pageblock_set.all %}
{% renderjs block %}
{% endfor %}
{% endblock %}

{% block css %}
{% for block in section.pageblock_set.all %}
{% rendercss block %}
{% endfor %}
{% endblock %}

{% block bodyclass %}module-{{module.slug}}{% endblock %}

{% block bodyid %}section-{{section.id}}{% endblock %}

{% block title %}{{section.label}}{% endblock %}

{% block pagetitle %}<h1>{{section.label}}</h1>{% endblock %}



{% block navrightextra %}
{% if not request.user.is_anonymous %}
<li><a href="{{section.get_edit_url}}" class="btn-success">edit page</a></li>
{% endif %}
{% endblock %}


{% block sidenav %}
        <!-- ###### Secondary Navigation ###### -->
        {% if module.get_children %}
        {% include "pagetree/menu.html" %}
        {% endif %}
{% endblock %}

{% block content %}
<div id="content">
{% if needs_submit %}
{% if is_submitted %}
{% else %}
<!--<form action="." method="post">-->
{% endif %}
{% endif %}

{% for block in section.pageblock_set.all %}

{% if block.block.display_name == "Gate Block" %}

<div class="pageblock{% if block.css_extra %} {{block.css_extra}}{% endif %}">

{% if block.label %}<h3>{{block.label}}</h3>{% endif %}
{% render block %}
</div>

{% elif block.block.display_name == "Case Quiz" %}
{% for quiz in case_quizblocks %}
            {% if quiz.id == block.id %}
                {% if quiz.completed != True%}
                <form action="." method="post">
        {% endif %}
    {% endif %}
{% endfor %}
<div class="pageblock{% if block.css_extra %} {{block.css_extra}}{% endif %}">
    {% if block.label %}
        
        <h3>{{block.label}}</h3>
    {% endif %}
{% render block %}
</div>
{% for quiz in case_quizblocks %}
            {% if quiz.id == block.id %}
                {% if quiz.completed != True%}
                <input type="hidden" name="pageblock-{{block.id}}-case" value="{{case.id}}" />
                <input type="submit" value="Submit Case Quiz" class="btn btn-primary" />
                 </form>
        {% endif %}
    {% endif %}
{% endfor %}
{% elif block.block.display_name == "Text BlockDT" %}
{% is_block_on_user_path request section block casemap.value as user_path %}
  {% if user_path %}
    <div class="pageblock{% if block.css_extra %} {{block.css_extra}}{% endif %}">
  
    {% if block.label %}<h3>{{block.label}}</h3>{% endif %}
    {% render block %}
    </div>
  {%endif%}
{% else %}

    <div class="pageblock{% if block.css_extra %} {{block.css_extra}}{% endif %}">

    {% if block.label %}<h3>{{block.label}}</h3>{% endif %}
    {% render block %}
    </div>

{% endif %}
{% endfor %}

{% include "pagetree/toc.html" %}

</div>


{% endblock %}

{% block content-nav %}

{% if request.user.is_superuser %}
{% else %}
{% with previous=section.get_previous next_section=section.get_next %}
    <ul class="pager">
    {% if previous %}
      <li class="previous">
            <a href="{{previous.get_absolute_url}}">&larr; Previous</a>
      </li>
    {% endif %}

    {% if next_section %}
    {% is_section_unlocked request section as unlocked %}
    <li class="next"><a class="{% if unlocked %}{% else %}disabled{%endif%}" href="{% if unlocked %}{{next_section.get_absolute_url}}{%endif%}">Next &rarr;</a></li>

    {% endif %}
    </ul>

{% endwith %}
{% endif %}
{% endblock %}

{% block library %}
    <div class="col-md-4" id="library-item-view">
        <div class="panel panel-default">
        <!-- Default panel contents -->
        <div class="panel-heading header">Library</div>
        <table class="table">
        <thead>
            <tr>
                <th>Name</th>
                <th>Document</th>
            </tr>
        </thead>
        <tbody>
        {% for item in library_items %}
            <tr>
                <td> {{item.name}} </td>
                <td class="library-item-document"> 
                    <span class="hidden">{{item.id}}</span>
                    <a target="_blank" href="/uploads/{{item.doc}}">Document link</a> 
                </td>
            </tr>
        {% endfor %}
        </tbody>
        </table>
    </div><!--end #library-item-view-->
{% endblock %}


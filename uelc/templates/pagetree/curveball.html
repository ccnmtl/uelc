{% load get_selected_curveball %}
{% load bootstrap %}

<div class="gated-curveball panel panel-default">
{% get_selected_curveball u.0 sec.7.1 as selected_curveball %}
    {% if selected_curveball %}
        <div class="panel-heading">
             <p>Selected Curveball:</p>
        </div>
        <div class="panel-body">
             <p>{{ selected_curveball.curveball.title }}</p>
        </div>
    {% else %}
        <form id="curveball-form-{{ sec.7.1.id }}" action="." method="post">{% csrf_token %}
        {{sec.7.1.curveball_select_form|bootstrap}}
        <input type="hidden" name="curveball-block-id" value="{{ sec.7.1.id }}" />
        <input type="hidden" name="user_id" value="{{u.0.id}}" />
        <input type="hidden" name="curveball-select" value="submit" />
        </form>
         <button class="pull-left btn btn-default curveball-commit-btn" data-toggle="modal" data-target="#CurveballModal-{{ sec.7.1.id }}">Commit</button> 
         <span class="clearfix"></span>
    {% endif %}
</div>

<div class="modal fade in" id="CurveballModal-{{ sec.7.1.id }}" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="false" style="display: none;">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">Ã—</span></button> 
                        <h4 class="modal-title" id="myModalLabel">
                           Set Curveball
                        </h4>
                    </div>
                    <div class="modal-body">
                        Are you sure? This cannot be undone.
                        <div class="hidden loading-spinner">Setting your curveball! One moment...</div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary set-curveball">Yes. Set it.</button> <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button> 
                    </div>
                </div>
            </div>
        </div>

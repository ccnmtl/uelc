{% extends 'base.html' %}
{% load bootstrap %}
{% load accessible %}
{% block css %}
    <link rel="stylesheet" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.8.3/themes/base/jquery-ui.css" type="text/css" media="all" />

    <style type="text/css">
        .draghandle {float: left;}
        #questions {list-style-type: none; margin: 0; padding: 0;}
        #questions li { margin: 0 3px 3px 3px; padding: 0.4em;
        padding-left: 1.5em; 
              background-color: #ddd;
        }
        #questions li span { position: absolute; margin-left: -1.3em; }
        .dragging {border: #f60 solid 1px;}
    </style>
{% endblock %}

{% block js %}

    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript" ></script>
    <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.8.18/jquery-ui.min.js" type="text/javascript"></script>

    <script type="text/javascript">
        var saveOrder = function() {
            var url = "{% url 'reorder-questions' quiz.id %}?";
            var worktodo = 0;
            jQuery("#questions li").each(function(index,element) {
               worktodo = 1;
               var id = jQuery(element).attr('id').split("-")[1];
               url += "question_" + index + "=" + id + ";";
            });
            if (worktodo == 1) {
                var req = new XMLHttpRequest();
                req.open("POST",url,true);
                req.setRequestHeader("X-CSRFToken", '{{csrf_token}}');
                req.send(null);
            }
        };
        
        jQuery(document).ready(function() {
            jQuery("#questions").sortable({
              containment : 'parent'
              ,axis : 'y'
              ,tolerance: 'pointer'
              ,activeClass: 'dragging'
              ,handle: '.draghandle'
              ,stop: function (event,ui) { saveOrder();}
            });
            jQuery("#questions").disableSelection();
          });

    </script>

{% endblock %}

{% block content %}
{% get_quizblock_attr quiz.id as quizblock %}
<ul class="breadcrumb">
	<li><a href="{{quizblock.edit_url}}"><!--{{quizblock.label}}-->Back to Page Edit</a>
		
	</li>
	<li>Edit Decision</li>
</ul>


<h2>{{quizblock.label}}</h2>
{% for question in quiz.question_set.all %}
  <h4> Decision text</h4>
  <p> {{question.text}} </p>
  <p><a href="{% url 'add-case-answer-to-question' question.id %}"><button class="btn btn-primary btn-sm">Add or Edit Choices for this Decision</button></a></p>
  <p> <a href="{% url 'delete-question' question.id %}"><button class="btn btn-danger btn-sm">Delete Decision</button></a></p>
  
{% endfor %}

{% if quiz.question_set.all.count == 0 %}
<form action="add_question/" method="post" class="well form-horizontal">{% csrf_token %}
<h2>Add Decision</h2>
<table width="100%">
{{quiz.add_question_form|bootstrap}}
</table>
<input type="submit" value="add decision" class="btn btn-primary" />
</form>
<script>
jQuery(document).ready(function(){
  var questionType = jQuery('#id_question_type').parent().parent();
  var introText = jQuery('#id_intro_text').parent().parent();
  var explanation = jQuery('#id_explanation').parent().parent()
  // select only Multiple choice: Single Answer
  jQuery('#id_question_type>option:eq(2)').prop('selected', true);
  questionType.hide();
  introText.hide();
  explanation.hide();
})
</script>
{% else %}
  {% for question in quiz.question_set.all %}
    
  {% endfor %}
{% endif %}
{% endblock %}

{% block primarynavrightextra %}
    <li><a href="{{section.get_absolute_url}}">View</a></li>
{% endblock %}
